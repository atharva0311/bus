{% extends 'admin_panel/base.html' %}

{% block title %}Analytics - BusTrack{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-graph-up me-2"></i>Analytics Dashboard</h2>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Booking Status Distribution</h6>
            </div>
            <div class="card-body">
                <canvas id="bookingChart" height="200"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Trip Status Distribution</h6>
            </div>
            <div class="card-body">
                <canvas id="tripChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Daily Bookings (Last 7 Days)</h6>
            </div>
            <div class="card-body">
                <canvas id="dailyChart" height="100"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var bookingData = {{ booking_stats|safe }};
    var tripData = {{ trip_stats|safe }};
    var dailyData = {{ daily_bookings|safe }};
    
    var bookingLabels = [];
    var bookingCounts = [];
    bookingData.forEach(function(item) {
        bookingLabels.push(item.status.charAt(0).toUpperCase() + item.status.slice(1));
        bookingCounts.push(item.count);
    });
    
    new Chart(document.getElementById('bookingChart'), {
        type: 'doughnut',
        data: {
            labels: bookingLabels.length ? bookingLabels : ['No Data'],
            datasets: [{
                data: bookingCounts.length ? bookingCounts : [1],
                backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d']
            }]
        },
        options: { responsive: true }
    });
    
    var tripLabels = [];
    var tripCounts = [];
    tripData.forEach(function(item) {
        tripLabels.push(item.status.replace('_', ' ').charAt(0).toUpperCase() + item.status.slice(1));
        tripCounts.push(item.count);
    });
    
    new Chart(document.getElementById('tripChart'), {
        type: 'doughnut',
        data: {
            labels: tripLabels.length ? tripLabels : ['No Data'],
            datasets: [{
                data: tripCounts.length ? tripCounts : [1],
                backgroundColor: ['#17a2b8', '#28a745', '#ffc107', '#dc3545', '#6c757d']
            }]
        },
        options: { responsive: true }
    });
    
    var dailyLabels = [];
    var dailyCounts = [];
    dailyData.forEach(function(item) {
        dailyLabels.push(item.date);
        dailyCounts.push(item.count);
    });
    
    new Chart(document.getElementById('dailyChart'), {
        type: 'bar',
        data: {
            labels: dailyLabels.length ? dailyLabels : ['No Data'],
            datasets: [{
                label: 'Bookings',
                data: dailyCounts.length ? dailyCounts : [0],
                backgroundColor: '#e63946'
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        }
    });
});
</script>
{% endblock %}
